name: Create Issues

on:
  workflow_dispatch:

jobs:
  create_issues:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      # Install yq (YAML → JSON)
      - name: Install yq
        run: |
          sudo wget https://github.com/mikefarah/yq/releases/download/v4.43.1/yq_linux_amd64 -O /usr/bin/yq
          sudo chmod +x /usr/bin/yq

      # Convert YAML → JSON array
      - name: Convert issues.yaml to json
        run: |
          yq -o=json '.issues' .github/issues.yaml > issues.json
          cat issues.json

      # Loop through JSON and create issues
      - name: Create GitHub Issues
        run: |
          for row in $(jq -c '.[]' issues.json); do
            title=$(echo "$row" | jq -r '.title')
            body=$(echo "$row" | jq -r '.overview')
            labels=$(echo "$row" | jq -r '.labels | join(",")')

            echo "Creating issue: $title"

            gh issue create \
              --repo "${{ github.repository }}" \
              --title "$title" \
              --body "$body" \
              --label "$labels"
          done
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
